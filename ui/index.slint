import { Button, VerticalBox, HorizontalBox, TextEdit } from "std-widgets.slint";
import { NewConnectionDialog } from "partials/NewConnectionDialog.slint";
import { CButton } from "widgets/CButton.slint";
import { Icons } from "icons.slint";
import { Theme } from "theme.slint";
import { Shadow } from "widgets/Shadow.slint";
import { MenuBar } from "partials/MenuBar.slint";
import { DatabaseBrowser } from "partials/DatabaseBrowser.slint";
import { QueryEditor } from "partials/QueryEditor.slint";

export component AppWindow inherits Window {
    // #region Window Properties
    title: "Orbita";
    icon: Icons.icon_orbita;
    width: 1200px;
    height: 700px;
    background: Theme.background;
    // #endregion
    // #region Properties
    property <bool> dialog-visible: false;
    in-out property <string> connection_name;
    in-out property <string> database_type;
    in-out property <string> db_host;
    in-out property <string> db_port;
    in-out property <string> db_name;
    in-out property <string> db_user;
    in-out property <string> db_password;
    in-out property <string> query_text;
    // #endregion
    // #region Callbacks
    callback rTestConnection();
    callback rExecuteQuery();
    // #endregion
    VerticalLayout {
        height: 100%;
        width: 100%;
        Rectangle {
            MenuBar {
                // items: [{ text: "Open" }, { text: "Execute" }, { text: "Save" }, { text: "Settings" }];
                showAddButton: true;
                addConnectionClicked => {
                    dialog-visible = true;
                }
            }
        }

        HorizontalLayout {
            height: parent.height - 50px;
            Rectangle {
                width: 300px;
                DatabaseBrowser {
                    item-selected(type, name) => {
                        // https://gist.github.com/Wilovy09/21b43df9928c87ea147affbc5f868bb8
                        // content.text = "Seleccionado " + type + ": " + name;
                    }
                }
            }

            Rectangle {
                width: parent.width - 300px;
                QueryEditor {
                    query_text <=> root.query_text;
                }
            }
        }
    }

    Shadow {
        width: 100%;
        height: 100%;
        visible: dialog-visible;
        new-connection-dialog := NewConnectionDialog {
            visible: dialog-visible;
            connection_name <=> root.connection_name;
            database_type <=> root.database_type;
            db_host <=> root.db_host;
            db_port <=> root.db_port;
            db_name <=> root.db_name;
            db_user <=> root.db_user;
            db_password <=> root.db_password;
            testConnection => {
                rTestConnection();
            }
            close-dialog => {
                dialog-visible = false;
            }
        }
    }
}
